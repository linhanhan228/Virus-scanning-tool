# 病毒查杀工具使用文档

## 目录

1. [项目概述](#项目概述)
2. [系统要求](#系统要求)
3. [安装指南](#安装指南)
4. [配置说明](#配置说明)
5. [命令行使用](#命令行使用)
6. [功能详解](#功能详解)
7. [API接口](#api接口)
8. [故障排除](#故障排除)
9. [最佳实践](#最佳实践)

---

## 项目概述

### 简介

本工具是一款基于Rust开发的企业级病毒查杀工具，专为Linux系统设计，具备高效的恶意软件检测与清除能力。工具集成了ClamAV病毒库，支持多种扫描模式、实时文件监控、自动病毒库更新等功能。

### 主要特性

- **高效扫描引擎**: 支持快速扫描、全盘扫描和自定义路径扫描
- **实时文件监控**: 基于inotify的实时文件系统监控
- **ClamAV病毒库**: 集成开源可靠的ClamAV病毒特征码库
- **自动更新机制**: 支持定时和手动更新病毒库
- **多格式报告**: 支持JSON、YAML、HTML、TEXT格式的扫描报告
- **RESTful API**: 提供完整的API接口，支持企业级集成
- **安全设计**: 遵循最小权限原则，支持低权限运行
- **性能优化**: 多线程并发扫描，智能资源调度

### 技术架构

- **编程语言**: Rust 2021 Edition
- **异步运行时**: Tokio
- **病毒库**: ClamAV (main.cvd, daily.cvd, bytecode.cvd)
- **文件监控**: inotify (Linux)
- **API框架**: Warp
- **数据库**: SQLite
- **配置格式**: YAML

---

## 系统要求

### 操作系统

- Ubuntu 20.04+
- CentOS 7+
- Debian 10+
- 其他主流Linux发行版

### 硬件要求

- **CPU**: 多核处理器，建议4核以上
- **内存**: 最小2GB，建议4GB以上
- **磁盘**: 至少500MB可用空间（病毒库约200MB）
- **网络**: 需要互联网连接以更新病毒库

### 软件依赖

- Rust 1.70+ (编译时需要)
- OpenSSL
- SQLite 3

### 权限要求

- 普通用户权限即可运行
- 某些功能需要root权限（如全盘扫描、系统目录监控）
- 建议使用专用用户账户运行

---

## 安装指南

### 从源码编译

```bash
# 克隆项目
git clone <repository-url>
cd virus-scanning-tool

# 编译发布版本
cargo build --release

# 安装到系统路径
sudo cp target/release/virus-scanner /usr/local/bin/
sudo chmod +x /usr/local/bin/virus-scanner
```

### 创建配置文件

```bash
# 创建配置目录
sudo mkdir -p /etc/virus-scanner

# 生成默认配置文件
virus-scanner scan --help  # 首次运行会自动生成配置文件
```

### 创建必要的目录

```bash
# 创建数据库目录
sudo mkdir -p /var/lib/virus-scanner/database
sudo mkdir -p /var/lib/virus-scanner/backups
sudo mkdir -p /var/lib/virus-scanner/quarantine

# 创建日志目录
sudo mkdir -p /var/log/virus-scanner

# 创建报告目录
sudo mkdir -p /var/lib/virus-scanner/reports

# 设置权限
sudo chown -R $(whoami):$(whoami) /var/lib/virus-scanner
sudo chown -R $(whoami):$(whoami) /var/log/virus-scanner
```

### 验证安装

```bash
# 查看版本信息
virus-scanner --version

# 查看帮助信息
virus-scanner --help

# 检查病毒库状态
virus-scanner status --database
```

---

## 配置说明

### 配置文件位置

默认配置文件路径: `/etc/virus-scanner/config.yaml`

可以通过 `-c` 或 `--config` 参数指定自定义配置文件。

### 配置文件结构

```yaml
scan_modes:
  quick_scan_paths:
    - "/bin"
    - "/sbin"
    - "/usr/bin"
    - "/etc"
    - "/usr/sbin"
  exclude_paths:
    - "/proc"
    - "/sys"
  exclude_extensions:
    - "log"
    - "txt"
  max_file_size: 104857600  # 100MB

performance:
  thread_pool_size: 4        # 线程数，建议设置为CPU核心数
  cpu_usage_limit: 70.0     # CPU使用率限制（%）
  memory_limit_mb: 200      # 内存限制（MB）
  scan_buffer_size: 8192    # 扫描缓冲区大小（字节）

security:
  run_as_user: null         # 运行用户，null表示当前用户
  database_encryption: true # 是否加密病毒库
  audit_log_enabled: true   # 是否启用审计日志
  quarantine_dir: "/var/lib/virus-scanner/quarantine"

logging:
  level: "INFO"             # 日志级别: DEBUG, INFO, WARN, ERROR
  log_dir: "/var/log/virus-scanner"
  max_size_mb: 50           # 单个日志文件最大大小
  max_files: 10             # 保留的日志文件数量
  remote_logging: null      # 远程日志配置

update:
  enabled: true
  schedule:
    frequency: "daily"      # 更新频率: hourly, daily, weekly
    time: "03:00"           # 更新时间（24小时制）
    day_of_week: null       # 每周更新的星期几（0-6，0=周日）
  mirror_url: "https://database.clamav.net"
  verify_signatures: true   # 是否验证病毒库签名

monitor:
  enabled: false
  watch_paths:
    - "/tmp"
    - "/var/tmp"
  events:
    - "create"
    - "modify"
  actions:
    on_create: "quarantine"
    on_modify: "scan"
    on_delete: "log"
    auto_quarantine: false

report:
  enabled: true
  format: "json"            # 默认报告格式
  output_dir: "/var/lib/virus-scanner/reports"
  include_details: true
```

### 配置项说明

#### 扫描模式配置 (scan_modes)

- **quick_scan_paths**: 快速扫描的默认路径
- **exclude_paths**: 扫描时排除的路径
- **exclude_extensions**: 扫描时排除的文件扩展名
- **max_file_size**: 扫描的最大文件大小（字节）

#### 性能配置 (performance)

- **thread_pool_size**: 扫描线程池大小，建议设置为CPU核心数
- **cpu_usage_limit**: CPU使用率上限，防止扫描影响系统性能
- **memory_limit_mb**: 内存使用上限（MB）
- **scan_buffer_size**: 文件读取缓冲区大小

#### 安全配置 (security)

- **run_as_user**: 指定运行用户，null表示当前用户
- **database_encryption**: 是否加密病毒库数据库
- **audit_log_enabled**: 是否启用审计日志
- **quarantine_dir**: 隔离文件存储目录

#### 日志配置 (logging)

- **level**: 日志级别，可选值: DEBUG, INFO, WARN, ERROR
- **log_dir**: 日志文件存储目录
- **max_size_mb**: 单个日志文件最大大小（MB）
- **max_files**: 保留的日志文件数量
- **remote_logging**: 远程日志服务器配置

#### 更新配置 (update)

- **enabled**: 是否启用病毒库自动更新
- **schedule**: 定时更新配置
  - **frequency**: 更新频率（hourly, daily, weekly）
  - **time**: 更新时间（24小时制）
  - **day_of_week**: 每周更新的星期几（0-6）
- **mirror_url**: ClamAV镜像服务器URL
- **verify_signatures**: 是否验证病毒库签名

#### 监控配置 (monitor)

- **enabled**: 是否启用文件监控
- **watch_paths**: 监控的路径列表
- **events**: 监控的事件类型（create, modify, delete）
- **actions**: 事件触发时的动作
  - **on_create**: 文件创建时的动作
  - **on_modify**: 文件修改时的动作
  - **on_delete**: 文件删除时的动作
  - **auto_quarantine**: 是否自动隔离威胁文件

#### 报告配置 (report)

- **enabled**: 是否启用报告生成
- **format**: 默认报告格式（json, yaml, html, text）
- **output_dir**: 报告输出目录
- **include_details**: 是否包含详细信息

---

## 命令行使用

### 基本语法

```bash
virus-scanner [全局选项] <子命令> [子命令选项]
```

### 全局选项

- `-c, --config <路径>`: 指定配置文件路径
- `-v, --verbose`: 显示详细输出
- `-h, --help`: 显示帮助信息
- `--version`: 显示版本信息

### 子命令

#### 1. 扫描命令 (scan)

执行病毒扫描，支持多种扫描模式。

**基本用法:**

```bash
virus-scanner scan [选项]
```

**选项:**

- `-t, --scan-type <类型>`: 扫描类型
  - `quick`: 快速扫描（系统关键路径）
  - `full`: 全盘扫描
  - `custom`: 自定义路径扫描
- `-p, --paths <路径>`: 指定扫描路径（可多次使用）
- `-e, --exclude <路径>`: 排除路径（可多次使用）
- `--threads <数量>`: 指定线程数
- `--report`: 生成扫描报告
- `-f, --format <格式>`: 报告格式（json, yaml, html, text）

**示例:**

```bash
# 快速扫描系统关键路径
virus-scanner scan --scan-type quick

# 全盘扫描
virus-scanner scan --scan-type full

# 扫描指定目录
virus-scanner scan --scan-type custom --paths /home/user/documents --paths /tmp

# 扫描并生成JSON报告
virus-scanner scan --scan-type quick --report --format json

# 使用4个线程扫描，排除某些路径
virus-scanner scan --scan-type custom --paths /home/user --exclude /home/user/.cache --threads 4

# 显示详细输出
virus-scanner -v scan --scan-type full
```

#### 2. 更新命令 (update)

更新ClamAV病毒库。

**基本用法:**

```bash
virus-scanner update [选项]
```

**选项:**

- `-f, --force`: 强制更新
- `--schedule`: 启用定时更新
- `--check-only`: 仅检查更新

**示例:**

```bash
# 检查是否有新版本
virus-scanner update --check-only

# 强制更新病毒库
virus-scanner update --force

# 启用定时更新
virus-scanner update --schedule

# 强制更新并启用定时更新
virus-scanner update --force --schedule
```

#### 3. 监控命令 (monitor)

启动或停止文件监控。

**基本用法:**

```bash
virus-scanner monitor [选项]
```

**选项:**

- `-s, --start`: 启动监控
- `-p, --stop`: 停止监控
- `--watch <路径>`: 监控路径（可多次使用）

**示例:**

```bash
# 启动文件监控（使用配置文件中的路径）
virus-scanner monitor --start

# 停止文件监控
virus-scanner monitor --stop

# 启动监控并指定路径
virus-scanner monitor --start --watch /tmp --watch /var/tmp
```

#### 4. 报告命令 (report)

生成或转换扫描报告。

**基本用法:**

```bash
virus-scanner report [选项]
```

**选项:**

- `-i, --input <文件>`: 输入报告文件
- `-f, --format <格式>`: 报告格式（json, yaml, html, text）
- `-o, --output <文件>`: 输出报告文件

**示例:**

```bash
# 将JSON报告转换为HTML格式
virus-scanner report --input report.json --format html --output report.html

# 将JSON报告转换为文本格式
virus-scanner report --input report.json --format text --output report.txt

# 将YAML报告转换为JSON格式
virus-scanner report --input report.yaml --format json --output report.json
```

#### 5. 状态命令 (status)

查看系统状态和病毒库信息。

**基本用法:**

```bash
virus-scanner status [选项]
```

**选项:**

- `-d, --database`: 显示病毒库信息
- `-s, --system`: 显示系统信息

**示例:**

```bash
# 查看病毒库信息
virus-scanner status --database

# 查看系统信息
virus-scanner status --system

# 查看所有信息
virus-scanner status --database --system
```

---

## 功能详解

### 病毒扫描引擎

#### 扫描模式

1. **快速扫描 (Quick Scan)**
   - 扫描系统关键路径
   - 默认路径: /bin, /sbin, /usr/bin, /etc, /usr/sbin
   - 扫描速度快，适合日常检查

2. **全盘扫描 (Full Scan)**
   - 扫描整个文件系统
   - 扫描全面，但耗时较长
   - 建议在系统空闲时执行

3. **自定义扫描 (Custom Scan)**
   - 扫描用户指定的路径
   - 灵活性高，适合特定需求

#### 扫描性能

- **扫描速度**: 不低于50MB/s
- **内存占用**: 峰值不超过200MB
- **并发处理**: 支持多线程并发扫描
- **智能调度**: 根据系统负载动态调整资源使用

#### 扫描结果

扫描完成后会显示以下信息：
- 扫描文件数
- 发现威胁数
- 扫描耗时
- 扫描速度

### 实时文件监控

#### 监控功能

- **文件创建监控**: 检测新创建的文件
- **文件修改监控**: 检测文件内容变化
- **文件删除监控**: 记录文件删除操作

#### 监控动作

- **quarantine**: 自动隔离威胁文件
- **scan**: 扫描文件
- **log**: 记录事件到日志

#### 使用场景

- 监控临时文件目录（/tmp, /var/tmp）
- 监控下载目录
- 监控用户上传目录

### 病毒库更新

#### ClamAV病毒库

工具使用ClamAV的病毒特征码库，包含三个主要文件：

1. **main.cvd**: 主病毒库
   - 包含主要病毒特征码
   - 文件大小约150MB
   - 更新频率较低

2. **daily.cvd**: 每日更新
   - 包含最新病毒特征码
   - 文件大小约10-20MB
   - 每日更新

3. **bytecode.cvd**: 字节码库
   - 包含高级检测规则
   - 文件大小较小
   - 不定期更新

#### 更新机制

1. **手动更新**
   - 使用 `virus-scanner update --force` 命令
   - 立即下载并安装最新病毒库

2. **自动更新**
   - 使用 `virus-scanner update --schedule` 启用
   - 根据配置的时间自动更新
   - 支持hourly、daily、weekly频率

3. **检查更新**
   - 使用 `virus-scanner update --check-only` 命令
   - 仅检查是否有新版本，不下载

#### 更新流程

1. 检查当前版本
2. 下载最新病毒库文件
3. 备份当前病毒库
4. 安装新病毒库
5. 验证病毒库完整性
6. 更新版本信息

#### 备份与恢复

- 更新前自动备份当前病毒库
- 备份文件保存在 `/var/lib/virus-scanner/backups`
- 支持版本回滚

### 报告生成

#### 报告格式

1. **JSON格式**
   - 机器可读
   - 适合程序处理
   - 支持数据交换

2. **YAML格式**
   - 人类可读
   - 适合配置管理
   - 结构清晰

3. **HTML格式**
   - 网页显示
   - 适合浏览器查看
   - 包含样式和格式

4. **TEXT格式**
   - 纯文本
   - 适合命令行查看
   - 便于日志分析

#### 报告内容

- 扫描概要信息
- 扫描统计
- 威胁详情
- 受影响文件列表
- 处理建议
- 扫描时间戳

### 日志系统

#### 日志级别

- **DEBUG**: 调试信息
- **INFO**: 一般信息
- **WARN**: 警告信息
- **ERROR**: 错误信息

#### 日志功能

- **本地日志**: 保存到本地文件
- **日志轮转**: 自动轮转日志文件
- **远程日志**: 支持发送到远程服务器
- **审计日志**: 记录重要操作

#### 日志位置

- 日志目录: `/var/log/virus-scanner`
- 主日志文件: `virus-scanner.log`
- 审计日志文件: `audit.log`

---

## API接口

### 启动API服务

```bash
# 使用默认端口启动
virus-scanner api

# 指定端口启动
virus-scanner api --port 8080

# 指定绑定地址
virus-scanner api --host 0.0.0.0 --port 8080
```

### API端点

#### 1. 扫描API

**启动扫描**

```http
POST /api/v1/scan
Content-Type: application/json

{
  "scan_type": "quick",
  "paths": ["/home/user"],
  "exclude_paths": ["/home/user/.cache"],
  "threads": 4
}
```

**响应:**

```json
{
  "scan_id": "scan_123456",
  "status": "running",
  "started_at": "2024-01-08T10:00:00Z"
}
```

**查询扫描状态**

```http
GET /api/v1/scan/{scan_id}
```

**响应:**

```json
{
  "scan_id": "scan_123456",
  "status": "completed",
  "started_at": "2024-01-08T10:00:00Z",
  "completed_at": "2024-01-08T10:05:00Z",
  "files_scanned": 10000,
  "threats_found": 5,
  "duration_seconds": 300
}
```

#### 2. 病毒库API

**检查更新**

```http
GET /api/v1/database/check-update
```

**响应:**

```json
{
  "current_version": "1.0.0",
  "latest_version": "1.0.1",
  "update_available": true
}
```

**执行更新**

```http
POST /api/v1/database/update
Content-Type: application/json

{
  "force": true
}
```

**响应:**

```json
{
  "status": "success",
  "version": "1.0.1",
  "timestamp": "2024-01-08T10:00:00Z",
  "signatures_added": 1000,
  "signatures_removed": 50,
  "total_signatures": 500000
}
```

**获取病毒库信息**

```http
GET /api/v1/database/info
```

**响应:**

```json
{
  "version": "1.0.0",
  "signature_count": 500000,
  "last_update": "2024-01-08T10:00:00Z",
  "memory_usage_mb": 150
}
```

#### 3. 监控API

**启动监控**

```http
POST /api/v1/monitor/start
Content-Type: application/json

{
  "paths": ["/tmp", "/var/tmp"],
  "events": ["create", "modify"]
}
```

**响应:**

```json
{
  "status": "running",
  "monitor_id": "monitor_123456",
  "started_at": "2024-01-08T10:00:00Z"
}
```

**停止监控**

```http
POST /api/v1/monitor/stop
```

**响应:**

```json
{
  "status": "stopped",
  "stopped_at": "2024-01-08T10:05:00Z"
}
```

**获取监控事件**

```http
GET /api/v1/monitor/events?limit=100&offset=0
```

**响应:**

```json
{
  "events": [
    {
      "event_type": "create",
      "file_path": "/tmp/test.txt",
      "timestamp": "2024-01-08T10:00:00Z",
      "threat_detected": false
    }
  ],
  "total": 100,
  "limit": 100,
  "offset": 0
}
```

#### 4. 报告API

**生成报告**

```http
POST /api/v1/report/generate
Content-Type: application/json

{
  "scan_id": "scan_123456",
  "format": "html"
}
```

**响应:**

```json
{
  "report_id": "report_123456",
  "status": "generated",
  "file_path": "/var/lib/virus-scanner/reports/report_123456.html",
  "generated_at": "2024-01-08T10:00:00Z"
}
```

**下载报告**

```http
GET /api/v1/report/{report_id}/download
```

#### 5. 系统状态API

**获取系统状态**

```http
GET /api/v1/status
```

**响应:**

```json
{
  "version": "1.0.0",
  "uptime_seconds": 3600,
  "database": {
    "version": "1.0.0",
    "signature_count": 500000,
    "last_update": "2024-01-08T10:00:00Z"
  },
  "system": {
    "cpu_usage": 45.5,
    "memory_usage_mb": 150,
    "active_scans": 1,
    "active_monitors": 0
  }
}
```

### API认证

API支持多种认证方式：

1. **API Key认证**

```http
GET /api/v1/status
X-API-Key: your-api-key-here
```

2. **JWT Token认证**

```http
GET /api/v1/status
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

### 错误响应

所有API端点在出错时返回统一的错误格式：

```json
{
  "error": {
    "code": "INVALID_REQUEST",
    "message": "Invalid scan type specified",
    "details": {
      "field": "scan_type",
      "value": "invalid"
    }
  }
}
```

常见错误代码：
- `INVALID_REQUEST`: 请求参数无效
- `UNAUTHORIZED`: 未授权访问
- `NOT_FOUND`: 资源不存在
- `INTERNAL_ERROR`: 服务器内部错误
- `SCAN_IN_PROGRESS`: 扫描正在进行中
- `UPDATE_IN_PROGRESS`: 更新正在进行中

---

## 故障排除

### 常见问题

#### 1. 编译错误

**问题**: 编译时出现依赖错误

**解决方案**:
```bash
# 更新Rust工具链
rustup update

# 清理并重新编译
cargo clean
cargo build --release

# 如果缺少系统依赖，安装必要的库
sudo apt-get install libssl-dev pkg-config
```

#### 2. 权限错误

**问题**: 运行时出现权限不足错误

**解决方案**:
```bash
# 使用sudo运行（不推荐）
sudo virus-scanner scan --scan-type full

# 或者为当前用户设置适当的权限
sudo chown -R $USER:$USER /var/lib/virus-scanner
sudo chown -R $USER:$USER /var/log/virus-scanner
```

#### 3. 病毒库更新失败

**问题**: 病毒库更新失败，提示网络错误

**解决方案**:
```bash
# 检查网络连接
ping database.clamav.net

# 尝试使用其他镜像服务器
# 编辑配置文件，修改mirror_url
vim /etc/virus-scanner/config.yaml

# 检查磁盘空间
df -h

# 检查防火墙设置
sudo ufw status
```

#### 4. 扫描速度慢

**问题**: 扫描速度低于预期

**解决方案**:
```bash
# 增加线程数
virus-scanner scan --scan-type full --threads 8

# 检查系统负载
top

# 调整性能配置
vim /etc/virus-scanner/config.yaml
# 修改 thread_pool_size 和 cpu_usage_limit
```

#### 5. 内存占用过高

**问题**: 扫描时内存占用超过限制

**解决方案**:
```bash
# 减少线程数
virus-scanner scan --scan-type full --threads 2

# 调整内存限制
vim /etc/virus-scanner/config.yaml
# 修改 memory_limit_mb

# 排除大文件
virus-scanner scan --scan-type custom --paths /home/user --exclude /home/user/large-files
```

#### 6. 文件监控不工作

**问题**: 文件监控无法启动或没有响应

**解决方案**:
```bash
# 检查inotify限制
cat /proc/sys/fs/inotify/max_user_watches

# 增加inotify限制
echo 819200 | sudo tee /proc/sys/fs/inotify/max_user_watches

# 检查监控路径是否存在
ls -la /tmp

# 查看日志
tail -f /var/log/virus-scanner/virus-scanner.log
```

#### 7. 日志文件过大

**问题**: 日志文件占用过多磁盘空间

**解决方案**:
```bash
# 查看日志文件大小
du -sh /var/log/virus-scanner

# 清理旧日志
find /var/log/virus-scanner -name "*.log.*" -mtime +7 -delete

# 调整日志配置
vim /etc/virus-scanner/config.yaml
# 修改 max_size_mb 和 max_files
```

### 日志分析

#### 查看日志

```bash
# 查看最新日志
tail -f /var/log/virus-scanner/virus-scanner.log

# 查看错误日志
grep ERROR /var/log/virus-scanner/virus-scanner.log

# 查看特定时间的日志
grep "2024-01-08" /var/log/virus-scanner/virus-scanner.log
```

#### 常见日志信息

- **INFO**: 正常操作信息
- **WARN**: 警告信息，不影响功能
- **ERROR**: 错误信息，需要处理

### 性能调优

#### 系统级优化

```bash
# 增加文件描述符限制
ulimit -n 65536

# 优化I/O调度
echo deadline | sudo tee /sys/block/sda/queue/scheduler

# 禁用swap（如果有足够内存）
sudo swapoff -a
```

#### 应用级优化

```bash
# 调整线程池大小
vim /etc/virus-scanner/config.yaml
# 设置 thread_pool_size 为CPU核心数

# 调整缓冲区大小
# 设置 scan_buffer_size 为更大的值

# 启用数据库加密（如果安全性更重要）
# 设置 database_encryption 为 true
```

---

## 最佳实践

### 日常使用

#### 1. 定期扫描

```bash
# 每日快速扫描
0 2 * * * /usr/local/bin/virus-scanner scan --scan-type quick --report

# 每周全盘扫描
0 3 * * 0 /usr/local/bin/virus-scanner scan --scan-type full --report --format json
```

#### 2. 定期更新病毒库

```bash
# 每日自动更新（凌晨3点）
0 3 * * * /usr/local/bin/virus-scanner update --schedule
```

#### 3. 监控关键目录

```bash
# 监控临时目录
/usr/local/bin/virus-scanner monitor --start --watch /tmp --watch /var/tmp
```

### 安全建议

#### 1. 使用专用用户

```bash
# 创建专用用户
sudo useradd -r -s /bin/false virus-scanner

# 设置目录权限
sudo chown -R virus-scanner:virus-scanner /var/lib/virus-scanner
sudo chown -R virus-scanner:virus-scanner /var/log/virus-scanner

# 使用专用用户运行
sudo -u virus-scanner virus-scanner scan --scan-type quick
```

#### 2. 启用审计日志

```yaml
# 在配置文件中启用审计日志
security:
  audit_log_enabled: true
```

#### 3. 定期备份配置

```bash
# 备份配置文件
cp /etc/virus-scanner/config.yaml /etc/virus-scanner/config.yaml.backup

# 备份病毒库
cp -r /var/lib/virus-scanner/database /var/lib/virus-scanner/database.backup
```

### 性能优化

#### 1. 合理配置线程数

```yaml
# 根据CPU核心数配置
performance:
  thread_pool_size: 4  # 设置为CPU核心数
```

#### 2. 排除不必要的路径

```yaml
# 排除系统目录和临时文件
scan_modes:
  exclude_paths:
    - "/proc"
    - "/sys"
    - "/dev"
    - "/run"
  exclude_extensions:
    - "log"
    - "tmp"
    - "cache"
```

#### 3. 使用快速扫描

```bash
# 日常检查使用快速扫描
virus-scanner scan --scan-type quick

# 深度检查使用全盘扫描
virus-scanner scan --scan-type full
```

### 企业部署

#### 1. 集中管理

```bash
# 使用配置管理工具（如Ansible）部署
# 示例Ansible playbook
- name: Deploy virus scanner
  hosts: all
  tasks:
    - name: Copy configuration
      copy:
        src: config.yaml
        dest: /etc/virus-scanner/config.yaml
    - name: Start monitoring
      command: virus-scanner monitor --start
```

#### 2. 日志集中化

```yaml
# 配置远程日志
logging:
  remote_logging:
    endpoint: "https://log-server.example.com/api/logs"
    use_tls: true
    api_key: "your-api-key"
```

#### 3. API集成

```bash
# 启动API服务
virus-scanner api --host 0.0.0.0 --port 8080

# 使用API进行批量扫描
curl -X POST http://localhost:8080/api/v1/scan \
  -H "Content-Type: application/json" \
  -H "X-API-Key: your-api-key" \
  -d '{"scan_type": "quick"}'
```

### 监控和告警

#### 1. 系统监控

```bash
# 监控扫描进程
ps aux | grep virus-scanner

# 监控资源使用
top -p $(pgrep virus-scanner)

# 监控日志
tail -f /var/log/virus-scanner/virus-scanner.log
```

#### 2. 告警配置

```bash
# 配置邮件告警（需要额外工具）
# 示例：使用logwatch
apt-get install logwatch

# 配置病毒发现告警
grep "threat detected" /var/log/virus-scanner/virus-scanner.log | mail -s "Virus Detected" admin@example.com
```

### 故障恢复

#### 1. 病毒库恢复

```bash
# 从备份恢复病毒库
cp -r /var/lib/virus-scanner/backups/database_* /var/lib/virus-scanner/database

# 重新下载病毒库
virus-scanner update --force
```

#### 2. 配置恢复

```bash
# 从备份恢复配置
cp /etc/virus-scanner/config.yaml.backup /etc/virus-scanner/config.yaml

# 生成默认配置
virus-scanner scan --help
```

#### 3. 服务重启

```bash
# 停止监控
virus-scanner monitor --stop

# 停止API服务
pkill virus-scanner

# 重新启动
virus-scanner monitor --start
virus-scanner api
```

---

## 附录

### A. 配置文件完整示例

```yaml
scan_modes:
  quick_scan_paths:
    - "/bin"
    - "/sbin"
    - "/usr/bin"
    - "/etc"
    - "/usr/sbin"
  exclude_paths:
    - "/proc"
    - "/sys"
    - "/dev"
    - "/run"
  exclude_extensions:
    - "log"
    - "txt"
    - "tmp"
    - "cache"
  max_file_size: 104857600

performance:
  thread_pool_size: 4
  cpu_usage_limit: 70.0
  memory_limit_mb: 200
  scan_buffer_size: 8192

security:
  run_as_user: "virus-scanner"
  database_encryption: true
  audit_log_enabled: true
  quarantine_dir: "/var/lib/virus-scanner/quarantine"

logging:
  level: "INFO"
  log_dir: "/var/log/virus-scanner"
  max_size_mb: 50
  max_files: 10
  remote_logging:
    endpoint: "https://log-server.example.com/api/logs"
    use_tls: true
    api_key: "your-api-key"

update:
  enabled: true
  schedule:
    frequency: "daily"
    time: "03:00"
    day_of_week: null
  mirror_url: "https://database.clamav.net"
  verify_signatures: true

monitor:
  enabled: true
  watch_paths:
    - "/tmp"
    - "/var/tmp"
    - "/home/user/downloads"
  events:
    - "create"
    - "modify"
  actions:
    on_create: "quarantine"
    on_modify: "scan"
    on_delete: "log"
    auto_quarantine: false

report:
  enabled: true
  format: "json"
  output_dir: "/var/lib/virus-scanner/reports"
  include_details: true
```

### B. 命令速查表

| 命令 | 功能 | 示例 |
|------|------|------|
| `virus-scanner scan` | 执行病毒扫描 | `virus-scanner scan --scan-type quick` |
| `virus-scanner update` | 更新病毒库 | `virus-scanner update --force` |
| `virus-scanner monitor` | 文件监控 | `virus-scanner monitor --start` |
| `virus-scanner report` | 生成报告 | `virus-scanner report --input report.json --format html` |
| `virus-scanner status` | 查看状态 | `virus-scanner status --database` |

### C. 常用路径

| 路径 | 用途 |
|------|------|
| `/usr/local/bin/virus-scanner` | 可执行文件 |
| `/etc/virus-scanner/config.yaml` | 配置文件 |
| `/var/lib/virus-scanner/database` | 病毒库目录 |
| `/var/lib/virus-scanner/backups` | 备份目录 |
| `/var/lib/virus-scanner/quarantine` | 隔离目录 |
| `/var/lib/virus-scanner/reports` | 报告目录 |
| `/var/log/virus-scanner` | 日志目录 |

### D. 支持的Linux发行版

- Ubuntu 20.04, 22.04, 24.04
- CentOS 7, 8, 9
- Debian 10, 11, 12
- Fedora 35+
- Arch Linux
- openSUSE Leap 15+

### E. 技术支持

- **项目主页**: [项目URL]
- **问题反馈**: [Issues URL]
- **文档**: [Documentation URL]
- **邮件支持**: support@example.com

### F. 许可证

本项目采用 [MIT License](LICENSE) 许可证。

### G. 更新日志

#### 版本 1.0.0 (2024-01-08)

- 初始版本发布
- 支持快速扫描、全盘扫描、自定义扫描
- 集成ClamAV病毒库
- 实现实时文件监控
- 支持病毒库自动更新
- 提供RESTful API接口
- 支持多种报告格式
- 完善的日志系统
- 中文命令行界面

---

## 联系方式

如有问题或建议，请通过以下方式联系我们：

- 邮箱: support@example.com
- 项目主页: https://github.com/your-org/virus-scanner
- 文档: https://docs.example.com/virus-scanner

---

*最后更新: 2024-01-08*
